
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Merged Page</title>
        <style>body {
  font-family: Arial, sans-serif;
  background-color: #f4f4f9;
  margin: 0;
  padding: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  width: 100vw;
  overflow: hidden;
  background-size: cover; 
  background-position: center; 
  background-repeat: no-repeat; 
  height: 100vh; 
  margin: 0;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

a {
  text-decoration: none;
  color: black;
}

button {
  margin: 0 5px 0 5px;
}

.chatBot {
  position: fixed;
}

.chatBot {
  position: relative;
}

.header {
  height: 50px;
  width: 100%;
  display: flex;
  align-items: center;
  padding-top: 15px;
  padding-bottom: 10px;
  background: white;
}

.botIconBox{
  width: 50px;
  height: 50px;
  border: 2px solid #aaa;
  border-radius: 50%;
  background: #ddd;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  overflow: hidden;
  position: relative;
  margin-left: 12px;
}

#headerImg{
  width: 50px;
  height: 30px;
  border: 1px solid black;
  border-radius: 5px;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  overflow: hidden;
  position: relative;
  margin-left: 15px;
}

.header-right {
  margin-left: auto;
  margin-right: 25px;
  display: flex;
}

.resize {
  margin-top: 2px;
  margin-right: 20px;
}

.reset {
  margin-top: 4px;
}

.chatBot {
  transition: all 0.1s ease;
}

.botButton {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 60px;
  height: 60px;
  border: 2px solid black;
  border-radius: 50%;
  background-color: whitesmoke;
  color: black;
  display: flex;
  justify-content: center;
  align-items: center;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  cursor: pointer;
  overflow: hidden;
}

.botButton:hover {
  background-color: lightgray;
}

.chat-container {
  position: fixed;
  bottom: 100px;
  right: 20px;
  width: 25vw;
  height: 85vh;
  border: 1px solid #bbb;
  background: linear-gradient(to bottom, #f0f0f0, #b0b0b0);
  border-radius: 20px;
  box-shadow: 2px 4px 8px rgba(0, 0, 0, 0.2);
  opacity: 0;
  transform: translateY(20px);
  transition: opacity 0.3s ease, transform 0.3s ease;
  display: none;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  transition: all 0.5s ease-in-out;
  z-index: 1;
}

.chat-container.resized {
  position: unset;
  width: 40vw;
  height: 98vh;
}

.chat-container.show {
  opacity: 1;
  transform: translateY(0);
  display: flex;
}


.fileInput {
  height: 38px;
  width: 38px;
  margin-right: 5px;
  margin-left: 5px;
  display: flex;
  justify-content: center;
  align-items: center;
}

.fileButtons{
  position: fixed;
  bottom: 51px;
  left: 5px;
  display: none;
}

.fileButtons.show{
  display: unset;
}


.file-buttons{
  display: flex;
  height: 30px;
  border: 2px solid black;
  width: 68px;
  justify-content: center;
  align-items: center;
  padding: 5px;
  border-radius: 10px;
  padding-bottom: 3px;
}

.div-actual-btn-file{
  height: 40px;
  width: 25px;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
}

.div-url-input-icon{
  height: 40px;
  width: 25px;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  margin-left: auto;
}

label {
  width: 32px;
}

.file-shower{
  height: 40px;
  width: 40px;
  display: flex;
  justify-content: center;
  align-items: center;
}


svg:hover {
  cursor: pointer;
}

.fileInputs {
  display: flex;
  position: fixed;
  width: 88px;
  height: 40px;
  bottom: 5px;
  left: 5px;
  justify-content: center;
  align-items: center;
}

.sendButton {
  position: fixed;
  width: 40px;
  height: 40px;
  bottom: 5px;
  right: 10px;
  display: unset;
}

#sendUrl{
  display: none;
}

.chatbox {
  flex-grow: 1;
  overflow-y: auto;
  padding: 15px;
  padding-bottom: 15px;
  max-height: 730px;
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-bottom: 94px;
}

.chatbox img{
  max-width: 200px;
  margin: 5px;
  border-radius: 8px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
}

.chatboxtext {
  font-weight: 900;
}

.input-container {
  display: flex;
  align-items: center;
}

.voiceInput {
  height: 40px;
  width: 40px;
  border-radius: 50%;
  background-color: whitesmoke;
  display: flex;
  justify-content: center;
  align-items: center;
}

.voiceBars {
  height: 40px;
  width: 40px;
  border-radius: 50%;
  background-color: whitesmoke;
  display: flex;
  justify-content: center;
  align-items: center;
  display: none;
}

.bar {
  width: 4px;
  height: 20px;
  background-color: white;
  transition: height 0.1s;
}

#Outline{
    fill : #222222;
}

.userInput {
  background-color: whitesmoke;
  position: fixed;
  left: 93px;
  bottom: 5px;
  width: calc(25vw - 160px);  
  min-height: 63px;
  max-height: 20vh;
  border-width: 2px;
  border-radius: 22px;
  overflow-y: hidden;
  flex-grow: 1;
  padding: 10px;
  padding-left: 20px;
  padding-right: 40px;
  border: none;
  font-size: 14px;
  resize: none;
  display: flex;
  align-items: center;
  margin-bottom: 2px;
  word-wrap: break-word;
  overflow-wrap: break-word;
  white-space: pre-wrap;
}

.userInput.resized{
  width: calc(40vw - 160px);
}

#userInput:focus {
  border: none;
  outline: none;
}

.placeholder {
  position: relative;
}

.sendMessage {
  height: 40px;
  width: 40px;
  justify-content: center;
  align-items: center;
  
  display: flex;
  
}

.fileElement {
  cursor: pointer;
  position: fixed;
  bottom: 95px;
  justify-content: center;
  align-items: center;
  font-size: 12px;
  right: 15px;
  border: 2px solid black;
  border-radius: 13px;
  padding: 2px;
  display: none;
  overflow: hidden;
}

.fileElement.show {
  display: flex;
}

.input-image {
  align-self: flex-end;
}

/* User message styles (Left) */
.user-message {
  font-size: 14px;
  background-color: #d3d3d3;
  padding: 10px 15px;
  margin: 5px;
  border-radius: 20px;
  align-self: flex-end;
  max-width: 80%;
  word-wrap: break-word;
}

/* Bot message styles (Right) */
.bot-message {
  font-size: 14px;
    padding: 10px 15px;
    margin: 5px;
    border-radius: 20px;
    align-self: flex-start;
    max-width: 80%;
    word-wrap: break-word;
  background-color: whitesmoke;
}

/* Markdown styling */
.bot-message p {
  margin: 5px 0;
}

.user-message,
.bot-message {
  display: inline-block;
  margin-bottom: 5px;
}

/* Typing Indicator */
.typing-indicator {
  background-color: rgb(255, 255, 255);
  padding: 12px;
  margin: 5px;
  border-radius: 10px;
  align-self: flex-start;
  font-style: italic;
  font-weight: bold;
  font-size: 18px; /* Increased font size */
  letter-spacing: 3px; /* More spacing between dots */
  display: flex;
  gap: 8px;
}

/* Typing dots animation */
.typing-indicator span {
  display: inline-block;
  animation: typingDots 1.5s infinite ease-in-out;
}

/* Delays for rhythmic motion */
.typing-indicator span:nth-child(1) {
  animation-delay: 0s;
}
.typing-indicator span:nth-child(2) {
  animation-delay: 0.2s;
}
.typing-indicator span:nth-child(3) {
  animation-delay: 0.4s;
}

/* Keyframes for top-down rhythmic motion */
/* @keyframes typingDots {
  0% {
    transform: translateY(-10px);
    opacity: 0.3;
  }
  50% {
    transform: translateY(10px);
    opacity: 1;
  } 
  100% {
    transform: translateY(-10px);
    opacity: 0.3;
  }
} */
@keyframes typingDots {
  0%, 100% {
      transform: translateX(0);
      opacity: 0.5;
  }
  50% {
      transform: translateX(-8px);
      opacity: 1;
  }
}
</style>
    </head>
    <body>
        <!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chatbot</title>
    <link rel="stylesheet" href="../template/style.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/11.1.0/marked.min.js"></script>
  </head>
  <body>
    <div class="chatBot">
      <button class="botButton" id="botButton" onclick="togglePopup()">
        <img id="botButtonImage" />
      </button>
      <div class="chat-container" id="chat-container">
        <div class="header">
          <div class="botIconBox">
            <img id="botIcon" />
          </div>
          <div class="headerImg">
            <img id="headerImg" /> 
          </div>
          <div class="header-right">
            <div class="resize" onclick="resize()">
              <?xml version="1.0" encoding="utf-8"?><!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
              <svg
                width="25px"
                height="25px"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M14 10L20 4M20 4H15.5M20 4V8.5M4 4L10 10M4 4V8.5M4 4H8.5M14 14L20 20M20 20V15.5M20 20H15.5M10 14L4 20M4 20H8.5M4 20L4 15.5"
                  stroke="#000000"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </div>
            <div class="reset" onclick="reset()">
              <?xml version="1.0" encoding="utf-8"?><!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
              <svg
                fill="#000000"
                width="20px"
                height="20px"
                viewBox="0 0 1920 1920"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M960 0v213.333c411.627 0 746.667 334.934 746.667 746.667S1371.627 1706.667 960 1706.667 213.333 1371.733 213.333 960c0-197.013 78.4-382.507 213.334-520.747v254.08H640V106.667H53.333V320h191.04C88.64 494.08 0 720.96 0 960c0 529.28 430.613 960 960 960s960-430.72 960-960S1489.387 0 960 0"
                  fill-rule="evenodd"
                />
              </svg>
            </div>
          </div>
        </div>
        <div id="chatbox" class="chatbox">
          <p class="bot-message" id="firstBotMessage" style="display: unset">How can I assist you today?</p>
        </div>
        <div class="fileElement" id="fileElement">
          <div class="fileElementIcon">
            <?xml version="1.0" encoding="utf-8"?><!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
            <svg
              width="25px"
              height="25px"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M15 19L17 21L21 17M13 3H8.2C7.0799 3 6.51984 3 6.09202 3.21799C5.71569 3.40973 5.40973 3.71569 5.21799 4.09202C5 4.51984 5 5.0799 5 6.2V17.8C5 18.9201 5 19.4802 5.21799 19.908C5.40973 20.2843 5.71569 20.5903 6.09202 20.782C6.51984 21 7.0799 21 8.2 21H12M13 3L19 9M13 3V7.4C13 7.96005 13 8.24008 13.109 8.45399C13.2049 8.64215 13.3578 8.79513 13.546 8.89101C13.7599 9 14.0399 9 14.6 9H19M19 9V13.5"
                stroke="#000000"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
          </div>
        </div>
        <div class="fileButtons">
          <div class="file-buttons">
            <div class="div-actual-btn-file">
              <input type="file" id="actual-btn-file" hidden />
              <label for="actual-btn-file" class="file-input-icon">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  shape-rendering="geometricPrecision"
                  text-rendering="geometricPrecision"
                  image-rendering="optimizeQuality"
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  viewBox="0 0 512 386.883"
                >
                  <path
                    fill-rule="nonzero"
                    d="M377.763 115.7c-9.42 2.733-18.532 6.86-27.591 12.155-9.256 5.41-18.373 12.031-27.649 19.629l-19.849-22.742c16.721-15.527 33.187-26.464 49.108-33.514-13.06-22.39-31.538-38.532-52.418-48.549-21.339-10.238-45.242-14.171-68.507-11.922-23.123 2.234-45.56 10.619-64.123 25.025-21.451 16.646-37.775 41.521-44.034 74.469l-1.959 10.309-10.27 1.801c-27.993 4.909-49.283 18.793-62.859 36.776-7.186 9.518-12.228 20.161-14.969 31.19-2.728 10.979-3.193 22.399-1.243 33.525 3.291 18.766 13.592 36.737 31.669 50.382 5.467 4.128 11.376 7.709 17.886 10.48 6.215 2.647 13.017 4.612 20.558 5.686h78.258v30.246h-78.827l-1.891-.178c-11.099-1.413-20.982-4.186-29.914-7.99-8.994-3.829-16.989-8.65-24.264-14.142C20.256 299.753 6.183 275.02 1.628 249.05c-2.669-15.225-2.027-30.868 1.715-45.929 3.73-15.012 10.524-29.404 20.167-42.177 16.233-21.507 40.501-38.514 71.737-46.241 9.014-35.904 28.299-63.573 53.057-82.786C171.438 13.963 199.327 3.521 228.021.748c28.551-2.76 57.975 2.11 84.339 14.758 28.095 13.479 52.661 35.696 68.986 66.815 13.827-2.201 27.042-1.521 39.42 1.5 18.862 4.603 35.493 14.611 49.212 28.159 13.36 13.193 23.994 29.797 31.216 48.001 16.814 42.377 15.209 93.978-13.361 131.996-9.299 12.37-21.252 22.45-35.572 30.468-13.811 7.735-29.884 13.593-47.949 17.787l-3.368.414h-66.346V310.4h64.727c14.501-3.496 27.297-8.212 38.168-14.299 10.794-6.045 19.62-13.396 26.238-22.2 21.842-29.066 22.745-69.34 9.463-102.815-5.698-14.359-13.999-27.371-24.363-37.605-10.007-9.882-21.906-17.126-35.154-20.36-6.654-1.625-13.721-2.248-21.145-1.705l-14.769 4.284zM205.205 265.348c-5.288 6.391-14.756 7.285-21.148 1.997-6.391-5.288-7.285-14.757-1.997-21.148l59.645-72.019c5.288-6.392 14.757-7.285 21.148-1.998a15.053 15.053 0 012.707 2.921l60.072 72.279c5.287 6.359 4.42 15.802-1.939 21.09-6.359 5.287-15.801 4.42-21.089-1.939l-34.288-41.256.202 146.628c0 8.273-6.707 14.98-14.98 14.98-8.274 0-14.981-6.707-14.981-14.98l-.202-146.582-33.15 40.027z"
                  />
                </svg>
              </label>
            </div>

            <div class="div-url-input-icon">
              <label class="url-input-icon" onclick="fileUrlEnter()">
                <?xml version="1.0" encoding="utf-8"?><svg
                  version="1.1"
                  id="Layer_1"
                  xmlns="http://www.w3.org/2000/svg"
                  xmlns:xlink="http://www.w3.org/1999/xlink"
                  x="0px"
                  y="0px"
                  viewBox="0 0 122.88 122.88"
                  style="enable-background: new 0 0 122.88 122.88"
                  xml:space="preserve"
                >
                  <g>
                    <path
                      d="M37.49,53.69c1.25-1.25,3.27-1.25,4.51,0c1.25,1.25,1.25,3.27,0,4.51L6.61,93.6l22.67,22.67l0,0l35.44-35.44 c1.25-1.25,3.27-1.25,4.51,0c1.25,1.25,1.25,3.27,0,4.52L33.4,121.18v0l-0.01-0.01l-0.01,0.01c-1.14,1.14-2.62,1.7-4.11,1.7 c-1.38,0-2.76-0.49-3.86-1.47c-0.09-0.07-0.17-0.15-0.26-0.23l0,0L1.7,97.72C0.57,96.58,0,95.09,0,93.6c0-1.49,0.57-2.98,1.7-4.12 L37.49,53.69L37.49,53.69z M77.12,41.24c1.25-1.25,3.27-1.25,4.52,0c1.25,1.25,1.25,3.27,0,4.52l-31.4,31.4 c-1.25,1.25-3.27,1.25-4.51,0c-1.25-1.25-1.25-3.27,0-4.51L77.12,41.24L77.12,41.24z M85.6,68.98c-1.25,1.25-3.27,1.25-4.52,0 c-1.25-1.25-1.25-3.27,0-4.52l35.19-35.19L93.6,6.61L58.48,41.73c-1.25,1.25-3.27,1.25-4.51,0c-1.25-1.25-1.25-3.27,0-4.51 L89.48,1.7C90.62,0.57,92.11,0,93.6,0c1.49,0,2.98,0.57,4.12,1.7l23.46,23.46l0,0l-0.01,0.01l0.01,0.01 c1.14,1.14,1.7,2.62,1.7,4.11c0,1.49-0.57,2.98-1.7,4.12l0,0L85.6,68.98L85.6,68.98z"
                    />
                  </g>
                </svg>
              </label>
            </div>
          </div>
        </div>
        <div class="input-container">
          <div class="fileInputs" id="fileInputs">
            <div class="voiceInput" id="voiceInput">
              <?xml version="1.0" encoding="utf-8"?>
              <svg
                height="20px"
                width="20px"
                version="1.1"
                id="_x32_"
                xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink"
                viewBox="0 0 512 512"
                xml:space="preserve"
              >
                <style type="text/css">
                  .st0 {
                    fill: #000000;
                  }
                </style>
                <g>
                  <path
                    class="st0"
                    d="M379.937,200.743v49.573c-0.012,34.204-13.87,65.085-36.346,87.596
      c-22.513,22.478-53.382,36.335-87.586,36.335c-34.204,0-65.086-13.857-87.598-36.335c-22.476-22.511-36.333-53.393-36.345-87.596
      v-49.573H95.49v49.573c0.035,82.37,62.275,150.266,142.23,159.384v69.787h-46.727V512h130.027v-32.513h-46.727V409.7
      c79.942-9.119,142.182-77.014,142.218-159.384v-49.573H379.937z"
                  />
                  <path
                    class="st0"
                    d="M256.006,334.032c46.155,0,83.704-37.561,83.704-83.716V83.716C339.71,37.561,302.161,0,256.006,0
      c-46.156,0-83.717,37.561-83.717,83.716v166.599C172.289,296.471,209.85,334.032,256.006,334.032z M208.862,83.716
      c0-26,21.144-47.144,47.144-47.144c25.988,0,47.132,21.144,47.132,47.144v166.599c0,26-21.144,47.144-47.132,47.144
      c-26.001,0-47.144-21.144-47.144-47.144V83.716z"
                  />
                </g>
              </svg>
            </div>
            <div class="voiceBars" id="voiceBars">
              <?xml version="1.0" encoding="iso-8859-1"?>
              <!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
              <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
              <svg
                fill="#000000"
                version="1.1"
                id="Capa_1"
                xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink"
                width="20px"
                height="20px"
                viewBox="0 0 47 47"
                xml:space="preserve"
              >
                <g>
                  <g>
                    <g>
                      <path
                        d="M2.41,31.936c-1.331,0-2.41-1.078-2.41-2.41v-12.05c0-1.331,1.079-2.41,2.41-2.41s2.41,1.079,2.41,2.41v12.05
				C4.82,30.855,3.741,31.936,2.41,31.936z"
                      />
                    </g>
                    <g>
                      <path
                        d="M9.44,37.962c-1.331,0-2.41-1.079-2.41-2.41V11.448c0-1.331,1.079-2.41,2.41-2.41s2.41,1.079,2.41,2.41v24.104
				C11.851,36.883,10.771,37.962,9.44,37.962z"
                      />
                    </g>
                    <g>
                      <path
                        d="M16.47,34.948c-1.331,0-2.41-1.079-2.41-2.41V14.462c0-1.331,1.079-2.41,2.41-2.41c1.331,0,2.411,1.079,2.411,2.41
				v18.076C18.88,33.869,17.801,34.948,16.47,34.948z"
                      />
                    </g>
                    <g>
                      <path
                        d="M23.5,40.975c-1.331,0-2.41-1.078-2.41-2.41V8.436c0-1.331,1.079-2.41,2.41-2.41s2.41,1.079,2.41,2.41v30.128
				C25.91,39.896,24.831,40.975,23.5,40.975z"
                      />
                    </g>
                    <g>
                      <path
                        d="M30.529,47c-1.33,0-2.41-1.079-2.41-2.41V2.41c0-1.331,1.08-2.41,2.41-2.41c1.332,0,2.41,1.079,2.41,2.41v42.18
				C32.939,45.921,31.861,47,30.529,47z"
                      />
                    </g>
                    <g>
                      <path
                        d="M37.561,37.962c-1.332,0-2.41-1.079-2.41-2.41V11.448c0-1.331,1.078-2.41,2.41-2.41c1.33,0,2.41,1.079,2.41,2.41v24.104
				C39.971,36.883,38.891,37.962,37.561,37.962z"
                      />
                    </g>
                    <g>
                      <path
                        d="M44.59,28.923c-1.331,0-2.41-1.079-2.41-2.409v-6.026c0-1.331,1.079-2.41,2.41-2.41S47,19.157,47,20.488v6.026
				C47,27.844,45.921,28.923,44.59,28.923z"
                      />
                    </g>
                  </g>
                </g>
              </svg>
            </div>
            <div class="fileInput">
              <div class="file-shower" onclick="inputsToggle()">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  x="0px"
                  y="0px"
                  width="40px"
                  height="40px"
                  viewBox="0 0 50 50"
                >
                  <path
                    d="M 25 2 C 12.309295 2 2 12.309295 2 25 C 2 37.690705 12.309295 48 25 48 C 37.690705 48 48 37.690705 48 25 C 48 12.309295 37.690705 2 25 2 z M 25 4 C 36.609824 4 46 13.390176 46 25 C 46 36.609824 36.609824 46 25 46 C 13.390176 46 4 36.609824 4 25 C 4 13.390176 13.390176 4 25 4 z M 24 13 L 24 24 L 13 24 L 13 26 L 24 26 L 24 37 L 26 37 L 26 26 L 37 26 L 37 24 L 26 24 L 26 13 L 24 13 z"
                  ></path>
                </svg>
              </div>
            </div>
          </div>
          <textarea
            class="userInput"
            id="userInput"
            oninput="adjustHeight(this)"
            placeholder="Message"
            autocomplete="off"
          ></textarea>
          <div class="sendButton" id="sendButton">
            <div class="sendMessage" id="sendMessage" onclick="sendMessage()">
              <?xml version="1.0" encoding="utf-8"?><!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
              <svg
                width="25px"
                height="25px"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M20.33 3.66996C20.1408 3.48213 19.9035 3.35008 19.6442 3.28833C19.3849 3.22659 19.1135 3.23753 18.86 3.31996L4.23 8.19996C3.95867 8.28593 3.71891 8.45039 3.54099 8.67255C3.36307 8.89471 3.25498 9.16462 3.23037 9.44818C3.20576 9.73174 3.26573 10.0162 3.40271 10.2657C3.5397 10.5152 3.74754 10.7185 4 10.85L10.07 13.85L13.07 19.94C13.1906 20.1783 13.3751 20.3785 13.6029 20.518C13.8307 20.6575 14.0929 20.7309 14.36 20.73H14.46C14.7461 20.7089 15.0192 20.6023 15.2439 20.4239C15.4686 20.2456 15.6345 20.0038 15.72 19.73L20.67 5.13996C20.7584 4.88789 20.7734 4.6159 20.7132 4.35565C20.653 4.09541 20.5201 3.85762 20.33 3.66996ZM4.85 9.57996L17.62 5.31996L10.53 12.41L4.85 9.57996ZM14.43 19.15L11.59 13.47L18.68 6.37996L14.43 19.15Z"
                  fill="#000000"
                />
              </svg>
            </div>
          </div>
          <div class="sendButton" id="sendUrl">
            <div class="sendMessage" onclick="sendUrl()">
              <?xml version="1.0" encoding="utf-8"?><!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
              <svg
                width="25px"
                height="25px"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M20.33 3.66996C20.1408 3.48213 19.9035 3.35008 19.6442 3.28833C19.3849 3.22659 19.1135 3.23753 18.86 3.31996L4.23 8.19996C3.95867 8.28593 3.71891 8.45039 3.54099 8.67255C3.36307 8.89471 3.25498 9.16462 3.23037 9.44818C3.20576 9.73174 3.26573 10.0162 3.40271 10.2657C3.5397 10.5152 3.74754 10.7185 4 10.85L10.07 13.85L13.07 19.94C13.1906 20.1783 13.3751 20.3785 13.6029 20.518C13.8307 20.6575 14.0929 20.7309 14.36 20.73H14.46C14.7461 20.7089 15.0192 20.6023 15.2439 20.4239C15.4686 20.2456 15.6345 20.0038 15.72 19.73L20.67 5.13996C20.7584 4.88789 20.7734 4.6159 20.7132 4.35565C20.653 4.09541 20.5201 3.85762 20.33 3.66996ZM4.85 9.57996L17.62 5.31996L10.53 12.41L4.85 9.57996ZM14.43 19.15L11.59 13.47L18.68 6.37996L14.43 19.15Z"
                  fill="#000000"
                />
              </svg>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="../template/script.js"></script>
  </body>
</html>

        <script>
            botName = `hospitality`;
            botCode = `slxtTk`;
            // backend_url = "https://chatgenbackend-production.up.railway.app";
let backend_url = "http://127.0.0.1:8000";

// backend_url_websocket = "wss://chatgenbackend-production.up.railway.app";
let backend_url_websocket = "ws://127.0.0.1:8000"

function togglePopup() {
  var popup = document.getElementById("chat-container");
  let chat = document.getElementById("chat-container");

  if (chat.classList.contains("resized")) {
    chat.classList.remove("resized");
  }

  if (popup.classList.contains("show")) {
    popup.classList.remove("show");
    setTimeout(() => (popup.style.display = "none"), 300);
  } else {
    popup.style.display = "flex";
    setTimeout(() => popup.classList.add("show"), 10);
  }
}

// Check if Speech Recognition is available
const SpeechRecognition =
  window.SpeechRecognition || window.webkitSpeechRecognition;

if (!SpeechRecognition) {
  alert(
    "Your browser does not support Speech Recognition. Try using Google Chrome."
  );
} else {
  const recognition = new SpeechRecognition();
  recognition.continuous = false; // Keeps listening
  recognition.interimResults = false; // Shows partial results
  recognition.lang = "en-US"; // Set language

  recognition.onresult = function (event) {
    const transcript = event.results[0][0].transcript;
    output.value = output.value + transcript + " ";
    sendMessage();
  };

  recognition.onspeechend = function () {
    document.getElementById("voiceInput").style.display = "flex";
    document.getElementById("voiceBars").style.display = "none";
    setTimeout(() => {
      recognition.stop();
      mediaStream.getTracks().forEach((track) => track.stop());
      mediaStream = null;
    }, 1500); // Stops recording after 2.5 seconds of silence
  };

  recognition.onerror = function (event) {
    console.error("Speech recognition error:", event.error);
    alert("Error with speech recognition: " + event.error);
  };

  const output = document.getElementById("userInput");
  const toggle = document.getElementById("voiceInput");
  const toggle2 = document.getElementById("voiceBars");
  let mediaStream;

  // Function to ask for microphone permission
  async function requestMicrophonePermission() {
    try {
      mediaStream = await navigator.mediaDevices.getUserMedia({ audio: true });
      console.log("Microphone access granted.");
    } catch (error) {
      console.error("Microphone permission denied:", error);
      alert("Microphone access is required for speech recognition.");
    }
  }

  // Start Listening
  toggle.addEventListener("click", async () => {
    await requestMicrophonePermission(); // Ask for permission
    document.getElementById("voiceInput").style.display = "none";
    document.getElementById("voiceBars").style.display = "flex";
    recognition.start();
  });

  // Stop Listening
  toggle2.addEventListener("click", () => {
    document.getElementById("voiceInput").style.display = "flex";
    document.getElementById("voiceBars").style.display = "none";
    recognition.stop();
    mediaStream.getTracks().forEach((track) => track.stop());
    mediaStream = null;
  });
}

/*

Used for to make audio files and can be edited to make real-time speech recognition.


let mediaRecorder;
let audioChunks = [];
let mediaStream;
let audioUrl = "";

async function audioInput() {
  if (mediaRecorder && mediaRecorder.state === "recording") {
    mediaRecorder.stop();
    return;
  }

  try {
    // Request microphone access
    mediaStream = await navigator.mediaDevices.getUserMedia({ audio: true });
    console.log("Microphone permission granted!");

    console.log(mediaStream);

    // Check the permission status after requesting
    const permissionStatus = await navigator.permissions.query({
      name: "microphone",
    });
    console.log("Permission state:", permissionStatus.state);

    startRecording(mediaStream);
  } catch (error) {
    console.error("Microphone permission denied or an error occurred:", error);
  }
}

function startRecording(stream) {
  mediaRecorder = new MediaRecorder(stream);
  audioChunks = [];

  mediaRecorder.ondataavailable = (event) => {
    audioChunks.push(event.data);
  };

  mediaRecorder.onstop = () => {
    const reader = new FileReader();
    const audioBlob = new Blob(audioChunks, { type: "audio/wav" });
    reader.readAsDataURL(audioBlob);
    reader.onloadend = function () {
      const audio = document.createElement("audio");
      audio.controls = true;
      audio.src = reader.result;
      document.body.appendChild(audio);
      console.log(reader.result);
      audioUrl = reader.result;
    };

    // Create an audio element to play the recording

    if (mediaStream) {
      mediaStream.getTracks().forEach((track) => track.stop());
    }
  };

  mediaRecorder.start();
  console.log("Recording started...");
}

*/

//file handling

document
  .getElementById("actual-btn-file")
  .addEventListener("change", function (event) {
    const file = event.target.files[0]; // Get the uploaded file

    if (file) {
      if (file.type.startsWith("image/")) {
        // Ensure it's an image
        const reader = new FileReader(); // Convert file to Base64 URL
        reader.readAsDataURL(file);
        reader.onload = function () {
          // processImage(reader.result);
        };
        showfile(file.name, URL.createObjectURL(file));
      } else {
        alert("Please upload a valid image file.");
      }
    } else {
      alert("Please upload a image file.");
    }
  });

function showfile(filename, fileUrl) {
  let fileElement = document.getElementById("fileElement");
  let chatbox = document.getElementById("chatbox");
  let textArea = document.getElementById("userInput");
  fileElement.classList.add("show");
  fileElement.innerHTML += `<div class="fileElementName" id="fileElementName">${filename}</div>`;
  fileElement.onclick = function () {
    window.open(fileUrl, "_blank");
  };
  chatbox.style.marginBottom = 15 + textArea.scrollHeight + 40 + "px";

  document.getElementsByClassName("fileButtons")[0].classList.toggle("show");
}

function chatIconPreviewImage(url = "") {
  let userMessage = document.getElementById("userInput").value;
  let file = document.getElementById("actual-btn-file").files[0];

  if (url == "") {
    let reader = new FileReader();
    reader.onload = function (e) {
      let img = document.createElement("img");
      img.setAttribute("class", "input-image");
      img.src = e.target.result;
      img.onload = function () {
        chatbox.appendChild(img);
        addUserMessage(userMessage); // Append the image preview first
      };
    };
    reader.readAsDataURL(file);
  } else {
    let img = document.createElement("img");
    img.setAttribute("class", "input-image");
    img.src = url;
    img.alt = "Image";
    chatbox.appendChild(img);
    addUserMessage(userMessage);
  }

  scrollToBottom();
}

function addUserMessage(userMessage) {
  const chatbox = document.getElementById("chatbox");

  const messageDiv = document.createElement("p");
  messageDiv.classList.add("user-message");
  messageDiv.textContent = userMessage;
  chatbox.appendChild(messageDiv);
  

  showTypingIndicator();
  scrollToBottom();
}

function showTypingIndicator() {
  let typingIndicator = document.createElement("div");
  typingIndicator.classList.add("bot-message", "typing-indicator");
  typingIndicator.innerHTML = `<span>...</span>`;
  chatbox.appendChild(typingIndicator);
  scrollToBottom(); // Keep it in view
}

function removeTypingIndicator() {
  document.querySelectorAll(".typing-indicator").forEach((div) => div.remove());
}

let cancelTask = false;

async function sendMessage() {
  let userMessage = document.getElementById("userInput").value;
  let chatbox = document.getElementById("chatbox");
  let file = document.getElementById("actual-btn-file").files[0];

  cancelTask = false;

  if (userMessage.trim().length != 0) {

    if (document.getElementById("actual-btn-file").files.length) {
      chatIconPreviewImage();
      fileUpload(userMessage, chatbox, file);
    } else if (externalFileUrl != "") {
      chatIconPreviewImage(externalFileUrl);
      externalFileResponse(userMessage, chatbox, externalFileUrl);
      externalFileUrl = "";
    } else {
      addUserMessage(userMessage);
      textResponse(userMessage, chatbox);
    }

    resetAfterSend();

    scrollToBottom(); // Ensure the chat remains at the bottom
  }
}

async function textResponse(userMessage, chatbox) {
  try {
    const socket = new WebSocket(`${backend_url_websocket}/chat`);

    socket.onopen = () => {
      // Send user message after connection opens
      const messageData = { message: userMessage, file: [], code: botCode };
      socket.send(JSON.stringify(messageData));
    };

    // Create an empty message container for bot response
    let botMessageDiv = document.createElement("p");
    botMessageDiv.classList.add("bot-message");
    chatbox.appendChild(botMessageDiv);
    botMessageDiv.style.display = "none";

    let messageQueue = [];
    let isTyping = false;
    let autoScroll = true;

    chatbox.addEventListener("scroll", () => {
      const isAtBottom =
        chatbox.scrollHeight - chatbox.scrollTop <= chatbox.clientHeight + 10;
      autoScroll = isAtBottom;
    });

    const observer = new MutationObserver(() => {
      if (autoScroll) {
        chatbox.scrollTo({ top: chatbox.scrollHeight, behavior: "smooth" });
      }
    });

    observer.observe(chatbox, { childList: true, subtree: true });

    socket.onmessage = (event) => {
      try {
        const data = JSON.parse(event.data);

        if (data.answer) {
          messageQueue.push(data.answer);
          processQueue();
        }
      } catch (error) {
        console.error("Error parsing WebSocket message:", error);
      }
    };
    

    function processQueue() {
      if (isTyping || messageQueue.length === 0) {
        if (!isTyping && messageQueue.length === 0) {
          botMessageDiv.innerHTML = marked.parse(botMessageDiv.innerHTML);
        }
        return;
      }
  
      isTyping = true;
  
      let answerText = messageQueue.shift();
      let index = 0;
      const speed = 10; // Adjust speed (milliseconds per character)
  
      function typeWriter() {
        if (index < answerText.length) {
          const currentChar = answerText.charAt(index);

          if (botMessageDiv.style.display === "none") {
            removeTypingIndicator();
            botMessageDiv.style.display = "unset";
            botMessage = document.createElement("p");
            botMessageDiv.appendChild(botMessage);
          }

          if (currentChar === "\n") {
            // Parse existing content before creating a new div
            botMessage.innerHTML = marked.parse(
              botMessage.innerHTML
            );
            botMessage.innerHTML += currentChar;
            // Create a new message block for the next line
            botMessage = document.createElement("p");
            botMessageDiv.appendChild(botMessage);
          } else {
            botMessage.innerHTML += currentChar;
          }

          index++;
          setTimeout(typeWriter, speed);
        } else {
          isTyping = false;
          processQueue(); // Process the next message after completing the current one
        }
      }

    
  
      typeWriter();
    }

    socket.onerror = (error) => {
      console.error("WebSocket error:", error);
      removeTypingIndicator();
      chatbox.innerHTML += `<div class="bot-message error">Error receiving response.</div>`;
    };

    socket.onclose = () => {
      console.log("WebSocket closed.");
      removeTypingIndicator();
    };
  } catch (error) {
    removeTypingIndicator();
    chatbox.innerHTML += `<div class="bot-message error">Error connecting to server.</div>`;
  }
  
}

async function fileUpload(userMessage, chatbox, file) {
  const form = new FormData();
  form.append("file", file);
  form.append("code", botCode);

  try {
    const uploadResponse = await fetch(`${backend_url}/upload`, {
      method: "POST",
      body: form,
    });

    const uploadData = await uploadResponse.json();

    console.log(uploadData.id);

    fileResponse(userMessage, chatbox, uploadData.id);
  } catch (error) {
    removeTypingIndicator();
    if (!cancelTask) {
      chatbox.innerHTML += `<div class="bot-message error">Upload failed!</div>`;
    }
  }
}

async function fileResponse(userMessage, chatbox, id) {
  try {
    // Create a new WebSocket connection to your endpoint.
    const ws = new WebSocket(`${backend_url_websocket}/filechat`);


    // When the WebSocket connection opens, send the initial JSON payload.
    ws.onopen = () => {
      ws.send(
        JSON.stringify({
          query: userMessage,
          files: [
            {
              type: "image",
              transfer_method: "local_file",
              upload_file_id: id,
            },
          ],
          code: botCode, // Ensure botCode is defined in your scope
        })
      );
    };


    
    let botMessageDiv = document.createElement("p");
    botMessageDiv.classList.add("bot-message");
    chatbox.appendChild(botMessageDiv);
    botMessageDiv.style.display = "none";

    let messageQueue = [];
    let isTyping = false;
    let autoScroll = true;

    chatbox.addEventListener("scroll", () => {
      const isAtBottom =
        chatbox.scrollHeight - chatbox.scrollTop <= chatbox.clientHeight + 10;
      autoScroll = isAtBottom;
    });

    const observer = new MutationObserver(() => {
      if (autoScroll) {
        chatbox.scrollTo({ top: chatbox.scrollHeight, behavior: "smooth" });
      }
    });

    observer.observe(chatbox, { childList: true, subtree: true });


    // Listen for messages from the server.
    ws.onmessage = (event) => {
      removeTypingIndicator();
      try {
        const data = JSON.parse(event.data);

        if (data.answer) {
          messageQueue.push(data.answer);
          processQueue();
        }
      } catch (error) {
        console.error("Error parsing WebSocket message:", error);
      }
    };

    function processQueue() {
      if (isTyping || messageQueue.length === 0) {
        if (!isTyping && messageQueue.length === 0) {
          botMessageDiv.innerHTML = marked.parse(botMessageDiv.innerHTML);
        }
        return;
      }
  
      isTyping = true;
  
      let answerText = messageQueue.shift();
      let index = 0;
      const speed = 10; // Adjust speed (milliseconds per character)
  
      function typeWriter() {
        if (index < answerText.length) {
          const currentChar = answerText.charAt(index);

          if (botMessageDiv.style.display === "none") {
            removeTypingIndicator();
            botMessageDiv.style.display = "unset";
            botMessage = document.createElement("p");
            botMessageDiv.appendChild(botMessage);
          }

          if (currentChar === "\n") {
            // Parse existing content before creating a new div
            botMessage.innerHTML = marked.parse(
              botMessage.innerHTML
            );
            botMessage.innerHTML += currentChar;
            // Create a new message block for the next line
            botMessage = document.createElement("p");
            botMessageDiv.appendChild(botMessage);
          } else {
            botMessage.innerHTML += currentChar;
          }

          index++;
          setTimeout(typeWriter, speed);
        } else {
          isTyping = false;
          processQueue(); // Process the next message after completing the current one
        }
      }

    
  
      typeWriter();
    }


    // Handle any errors.
    ws.onerror = (error) => {
      console.error("WebSocket error:", error);
      removeTypingIndicator();
      if (!cancelTask) {
        chatbox.innerHTML += `<div class="bot-message error">Error connecting to server.</div>`;
        
      }
    };

    // When the WebSocket closes, remove the typing indicator.
    ws.onclose = () => {
      removeTypingIndicator();
    };
  } catch (error) {
    removeTypingIndicator();
    if (!cancelTask) {
      chatbox.innerHTML += `<div class="bot-message error">Error connecting to server.</div>`;
      
    }
  }
  
}

async function externalFileResponse(userMessage, chatbox, Url) {
  try {
    // Create a new WebSocket connection to your endpoint.
    const ws = new WebSocket(`${backend_url_websocket}/urlchat`);

    // When the WebSocket connection opens, send the initial JSON payload.
    ws.onopen = () => {
      ws.send(
        JSON.stringify({
          query: userMessage,
          files: [{ type: "image", transfer_method: "remote_url", url: Url }],
          code: botCode, // Ensure botCode is defined in your scope
        })
      );
    };

    let botMessageDiv = document.createElement("p");
    botMessageDiv.classList.add("bot-message");
    chatbox.appendChild(botMessageDiv);
    botMessageDiv.style.display = "none";

    let messageQueue = [];
    let isTyping = false;
    let autoScroll = true;

    chatbox.addEventListener("scroll", () => {
      const isAtBottom =
        chatbox.scrollHeight - chatbox.scrollTop <= chatbox.clientHeight + 10;
      autoScroll = isAtBottom;
    });

    const observer = new MutationObserver(() => {
      if (autoScroll) {
        chatbox.scrollTo({ top: chatbox.scrollHeight, behavior: "smooth" });
      }
    });

    observer.observe(chatbox, { childList: true, subtree: true });

    // Listen for messages from the server.
    ws.onmessage = (event) => {
      try {
        const data = JSON.parse(event.data);

        if (data.answer) {
          messageQueue.push(data.answer);
          processQueue();
        }
      } catch (error) {
        console.error("Error parsing WebSocket message:", error);
      }
    };

    function processQueue() {
      if (isTyping || messageQueue.length === 0) {
        if (!isTyping && messageQueue.length === 0) {
          botMessageDiv.innerHTML = marked.parse(botMessageDiv.innerHTML);
        }
        return;
      }
  
      isTyping = true;
  
      let answerText = messageQueue.shift();
      let index = 0;
      const speed = 10; // Adjust speed (milliseconds per character)
  
      function typeWriter() {
        if (index < answerText.length) {
          const currentChar = answerText.charAt(index);

          if (botMessageDiv.style.display === "none") {
            removeTypingIndicator();
            botMessageDiv.style.display = "unset";
            botMessage = document.createElement("p");
            botMessageDiv.appendChild(botMessage);
          }

          if (currentChar === "\n") {
            // Parse existing content before creating a new div
            botMessage.innerHTML = marked.parse(
              botMessage.innerHTML
            );
            botMessage.innerHTML += currentChar;
            // Create a new message block for the next line
            botMessage = document.createElement("p");
            botMessageDiv.appendChild(botMessage);
          } else {
            botMessage.innerHTML += currentChar;
          }

          index++;
          setTimeout(typeWriter, speed);
        } else {
          isTyping = false;
          processQueue(); // Process the next message after completing the current one
        }
      }

    
  
      typeWriter();
    }



    // Handle any errors.
    ws.onerror = (error) => {
      console.error("WebSocket error:", error);
      removeTypingIndicator();
      if (!cancelTask) {
        chatbox.innerHTML += `<div class="bot-message error">Error connecting to server.</div>`;
        
      }
    };

    // When the WebSocket closes, remove the typing indicator.
    ws.onclose = () => {
      removeTypingIndicator();
    };
  } catch (error) {
    removeTypingIndicator();
    if (!cancelTask) {
      chatbox.innerHTML += `<div class="bot-message error">Error connecting to server.</div>`;
      
    }
  }
  
}

// Auto scroll to bottom function
function scrollToBottom() {
  let chatbox = document.getElementById("chatbox");
  chatbox.scrollTop = chatbox.scrollHeight;
}

function adjustHeight(element) {
  let maxH = window.getComputedStyle(element).maxHeight;

  if (parseInt(element.scrollHeight, 10) < parseInt(maxH, 10)) {
    element.style.height = "auto";
    element.style.height = element.scrollHeight + "px";
    let fileElement = document.getElementById("fileElement");
    let chatbox = document.getElementById("chatbox");
    fileElement.style.bottom = 7 + element.scrollHeight + 5 + "px";
    if (fileElement.classList.length == 1) {
      chatbox.style.marginBottom = 15 + element.scrollHeight + 5 + "px";
    } else {
      chatbox.style.marginBottom = 15 + element.scrollHeight + 40 + "px";
    }
  }
}

async function resetVariable() {
  await fetch(`${backend_url}/reset`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ value: "", code: botCode }),
  });
}

function reset() {
  resetVariable();
  document
    .querySelectorAll(
      ".user-message, .bot-message, .typing-indicator, .fileElementName, .input-image"
    )
    .forEach((div) => div.remove());

  resetAfterSend();
  document.getElementById("voiceInput").style.display = "flex";
  document.getElementById("voiceBars").style.display = "none";

  cancelTask = true;
}

function resetAfterSend() {
  document.getElementById("actual-btn-file").value = "";
  document.getElementById("fileElement").classList.remove("show");
  document.getElementById("chatbox").style.marginBottom = "94px";
  let userInput = document.getElementById("userInput");
  userInput.style.height = 54 + "px";
  document.getElementById("fileElement").style.bottom = "95px";
  document.getElementById("userInput").value = "";

  document.querySelectorAll(".fileElementName").forEach((div) => div.remove());

  document.getElementsByClassName("fileButtons")[0].classList.remove("show");

  document.getElementById("userInput").placeholder = "Message";
  document.getElementById("sendButton").style.display = "unset";
  document.getElementById("sendUrl").style.display = "none";
}

function resize() {
  document.getElementById("chat-container").classList.toggle("resized");
  document.getElementById("userInput").classList.toggle("resized");
}

function inputsToggle() {
  document.getElementsByClassName("fileButtons")[0].classList.toggle("show");
}

function fileUrlEnter() {
  document.getElementById("userInput").placeholder = "Enter your URL here";
  document.getElementById("sendButton").style.display = "none";
  document.getElementById("sendUrl").style.display = "unset";
}

let externalFileUrl = "";

function sendUrl() {
  let url = document.getElementById("userInput").value;
  externalFileUrl = url;
  let urlName = url;
  if (url.length > 10) {
    urlName = url.slice(0, 10) + "....";
  }
  showfile(urlName, url);

  let userInput = document.getElementById("userInput");
  userInput.style.height = 54 + "px";
  document.getElementById("fileElement").style.bottom = "95px";
  document.getElementById("userInput").value = "";

  document.getElementsByClassName("fileButtons")[0].classList.remove("show");

  document.getElementById("userInput").placeholder = "Message";
  document.getElementById("sendButton").style.display = "unset";
  document.getElementById("sendUrl").style.display = "none";
}

// for to send message when enter is pressed and goes to new line when shift + enter is pressed
document.addEventListener("DOMContentLoaded", function () {
  let input = document.getElementById("userInput");

  input.addEventListener("keydown", function (event) {
    if (event.key === "Enter") {
      if (event.shiftKey) {
        event.preventDefault();
        const cursorPos = input.selectionStart;
        input.value =
          input.value.substring(0, cursorPos) +
          "\n" +
          input.value.substring(cursorPos);
        input.selectionStart = input.selectionEnd = cursorPos + 1;
      } else {
        event.preventDefault();
        if (document.getElementById("sendButton").style.display === "none") {
          sendUrl();
        } else {
          sendMessage();
        }
      }
    }
  });
});

document.addEventListener("DOMContentLoaded", function () {
  const imageContainer = document.getElementById("botIcon");
  const botButton = document.getElementById("botButtonImage");
  const headerImg = document.getElementById("headerImg");

  fetch(`${backend_url}/get_chatIcon/${botCode}`)
    .then(response => {
      if (!response.ok) throw new Error("Failed to fetch image");
      return response.json();
    })
    .then(data => {
      imageContainer.src = data.image_data;
    })
    .catch(error => console.error("Error loading image:", error));

    fetch(`${backend_url}/get_botIcon/${botCode}`)
    .then(response => {
      if (!response.ok) throw new Error("Failed to fetch image");
      return response.json();
    })
    .then(data => {
      botButton.src = data.image_data;
    })
    .catch(error => console.error("Error loading image:", error));

    fetch(`${backend_url}/get_bg/${botCode}`)
    .then(response => {
      if (!response.ok) throw new Error("Failed to fetch image");
      return response.json();
    })
    .then(data => {
      document.body.style.backgroundImage = `url("${data.image_data}")`;
    })
    .catch(error => console.error("Error loading image:", error));

    fetch(`${backend_url}/header_img/${botCode}`)
    .then(response => {
      if (!response.ok) throw new Error("Failed to fetch image");
      return response.json();
    })
    .then(data => {
      headerImg.src = data.data;
    })
    .catch(error => console.error("Error loading image:", error));

    fetch(`${backend_url}/chatbox_text/${botCode}`)
    .then(response => {
      if (!response.ok) throw new Error("Failed to fetch data");
      return response.json();
    })
    .then(data => {
      document.getElementById("firstBotMessage").innerHTML = data.data;
    })
    .catch(error => console.error("Error loading image:", error));

    fetch(`${backend_url}/chat_gradient/${botCode}`)
    .then(response => {
      if (!response.ok) throw new Error("Failed to fetch data");
      return response.json();
    })
    .then(data => {
      document.getElementsByClassName("chat-container")[0].style.background = data.data;
    })
    .catch(error => console.error("Error loading image:", error));

});
        </script>
    </body>
    </html>
    